<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Himanshu AI | Ultimate Neural Gateway</title>
    
    <script src="https://js.puter.com/v2/"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Outfit:wght@300;600;800&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

    <style>
        :root[data-theme="dark"] {
            --bg: #050507; --sidebar: rgba(10, 10, 12, 0.9); --text: #e4e4e7;
            --accent: #2ea44f; --research: #0969da; --glass: rgba(255, 255, 255, 0.03); 
            --border: rgba(255, 255, 255, 0.08); --input-bg: #111113;
        }
        :root[data-theme="light"] {
            --bg: #f8f9fa; --sidebar: #ffffff; --text: #1a1a1b;
            --accent: #1a7f37; --research: #0969da; --glass: rgba(0, 0, 0, 0.03); 
            --border: rgba(0, 0, 0, 0.1); --input-bg: #ffffff;
        }

        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif; display: flex; height: 100vh; overflow: hidden; transition: 0.3s; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: var(--sidebar); backdrop-filter: blur(20px); border-right: 1px solid var(--border); padding: 30px 20px; display: flex; flex-direction: column; z-index: 10; }
        .logo { font-size: 1.4rem; font-weight: 800; letter-spacing: -1px; margin-bottom: 30px; background: linear-gradient(90deg, var(--text), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .nav-content { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .nav-btn { padding: 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: 0.2s; border: 1px solid transparent; font-size: 0.9rem; }
        .nav-btn:hover { background: var(--glass); }
        .active-research { border-color: var(--research); color: var(--research); background: rgba(9, 105, 218, 0.1); }
        
        /* Main Viewport */
        .viewport { flex: 1; display: flex; flex-direction: column; position: relative; }
        #chat-flow { flex: 1; overflow-y: auto; padding: 40px 15%; scroll-behavior: smooth; }
        
        /* Messages */
        .msg { margin-bottom: 30px; display: flex; gap: 20px; animation: msgAppear 0.3s ease-out; }
        @keyframes msgAppear { from { opacity: 0; transform: translateY(10px); } }
        .avatar { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 1.2rem; }
        .ai-avatar { background: var(--accent); color: #fff; }
        .user-avatar { background: var(--glass); border: 1px solid var(--border); }
        .content { flex: 1; line-height: 1.6; word-wrap: break-word; }

        /* Inline Code & Images */
        pre { border-radius: 12px !important; margin: 15px 0 !important; font-size: 0.9rem !important; }
        .gen-image-wrapper { margin-top: 15px; border-radius: 16px; overflow: hidden; border: 1px solid var(--border); background: #000; width: fit-content; }
        .gen-image { max-width: 100%; height: auto; display: block; }
        .dl-btn { background: var(--accent); color: white; border: none; padding: 10px; width: 100%; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-family: inherit; font-weight: 600; }

        /* Input Deck */
        .input-deck { padding: 20px 15% 30px; background: linear-gradient(to top, var(--bg) 80%, transparent); }
        .bar-container { background: var(--input-bg); border: 1px solid var(--border); border-radius: 20px; padding: 10px 15px; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        textarea { flex: 1; background: none; border: none; color: var(--text); outline: none; font-size: 1rem; resize: none; max-height: 150px; font-family: inherit; }
        select { background: var(--glass); color: var(--text); border: 1px solid var(--border); border-radius: 8px; padding: 5px; cursor: pointer; }
        
        .action-icon { cursor: pointer; color: var(--text); opacity: 0.6; transition: 0.2s; }
        .action-icon:hover { opacity: 1; transform: scale(1.1); }
        .mic-active { color: #ff4b4b; opacity: 1; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        .footer { font-size: 0.75rem; text-align: center; opacity: 0.5; padding-top: 20px; border-top: 1px solid var(--border); }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">HIMANSHU AI</div>
        <div class="nav-content">
            <div class="nav-btn" onclick="setMode('chat')"><span class="material-symbols-rounded">bolt</span> Turbo Chat</div>
            <div id="res-btn" class="nav-btn" onclick="setMode('research')"><span class="material-symbols-rounded">analytics</span> Deep Research</div>
            <div class="nav-btn" onclick="toggleTheme()"><span class="material-symbols-rounded" id="theme-icon">light_mode</span> Switch Theme</div>
            <div class="nav-btn" onclick="clearMemory()"><span class="material-symbols-rounded">delete_sweep</span> Clear History</div>
        </div>
        <div class="footer">Built by <strong>Mohsin Pasha</strong><br>v6.2 Stable</div>
    </nav>

    <main class="viewport">
        <div id="chat-flow"></div>

        <div class="input-deck">
            <div class="bar-container">
                <select id="style-sel">
                    <option value="photorealistic">Realistic</option>
                    <option value="anime">Anime</option>
                    <option value="cyberpunk">Cyberpunk</option>
                    <option value="oil painting">Artistic</option>
                </select>
                <textarea id="main-in" placeholder="Type or use voice..." rows="1"></textarea>
                <span class="material-symbols-rounded action-icon" id="mic-btn" onclick="startVoice()">mic</span>
                <span class="material-symbols-rounded action-icon" style="color:var(--accent)" onclick="send()">send</span>
            </div>
        </div>
    </main>

    <script type="module">
        const NL_AUTH = "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";
        let currentMode = 'chat';
        let chatHistory = JSON.parse(localStorage.getItem('himanshu_history')) || [];

        // Initialization
        window.onload = () => {
            if (chatHistory.length === 0) {
                addMsg("Neural Link established. I am Himanshu AI, ready for complex synthesis.", 'ai');
            } else {
                chatHistory.forEach(m => renderMsg(m.text, m.role));
            }
        };

        // Theme Toggle
        window.toggleTheme = () => {
            const root = document.documentElement;
            const isDark = root.getAttribute('data-theme') === 'dark';
            root.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('theme-icon').innerText = isDark ? 'dark_mode' : 'light_mode';
        };

        // Voice Recognition (STT)
        window.startVoice = () => {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return alert("Speech not supported in this browser.");
            
            const recognition = new SpeechRecognition();
            const micBtn = document.getElementById('mic-btn');
            
            recognition.onstart = () => micBtn.classList.add('mic-active');
            recognition.onend = () => micBtn.classList.remove('mic-active');
            recognition.onresult = (event) => {
                document.getElementById('main-in').value = event.results[0][0].transcript;
            };
            recognition.start();
        };

        window.send = async () => {
            const input = document.getElementById('main-in');
            const val = input.value.trim();
            if(!val) return;

            addMsg(val, 'user');
            input.value = '';
            input.style.height = 'auto';

            if(val.toLowerCase().startsWith('/draw ')) {
                const style = document.getElementById('style-sel').value;
                await generateVisual(`${val.substring(6).trim()}, ${style} style`);
            } else {
                await callBrain(val);
            }
        };

        async function callBrain(prompt) {
            const msgObj = addMsg("Thinking...", 'ai', true);
            try {
                const res = await fetch('https://models.github.ai/inference/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${NL_AUTH}` },
                    body: JSON.stringify({
                        model: currentMode === 'research' ? 'openai/gpt-4o' : 'openai/gpt-4o-mini',
                        messages: [{ role: "user", content: prompt }]
                    })
                });
                const data = await res.json();
                const content = data.choices[0].message.content;
                msgObj.querySelector('.content').innerHTML = parseContent(content);
                saveToHistory(content, 'ai');
                Prism.highlightAll();
            } catch (e) {
                msgObj.querySelector('.content').innerText = "Neural Link failed. Verify permissions.";
            }
        }

        async function generateVisual(prompt) {
            const msgObj = addMsg(`Generating visual for: ${prompt}...`, 'ai', true);
            try {
                const img = await puter.ai.txt2img(prompt);
                msgObj.querySelector('.content').innerHTML = `<strong>Neural Synthesis Result:</strong>`;
                const wrapper = document.createElement('div');
                wrapper.className = "gen-image-wrapper";
                img.className = "gen-image";
                
                const btn = document.createElement('button');
                btn.className = "dl-btn";
                btn.innerHTML = `<span class="material-symbols-rounded">download</span> Save Asset`;
                btn.onclick = () => { const a = document.createElement('a'); a.href = img.src; a.download = `AI_Asset_${Date.now()}.png`; a.click(); };
                
                wrapper.append(img, btn);
                msgObj.querySelector('.content').appendChild(wrapper);
            } catch (e) { msgObj.querySelector('.content').innerText = "Image generation failed."; }
        }

        function addMsg(text, role, pending = false) {
            if (!pending) saveToHistory(text, role);
            return renderMsg(text, role);
        }

        function renderMsg(text, role) {
            const flow = document.getElementById('chat-flow');
            const div = document.createElement('div');
            div.className = 'msg';
            const icon = role === 'user' ? 'person' : 'sensors';
            div.innerHTML = `
                <div class="avatar ${role}-avatar"><span class="material-symbols-rounded">${icon}</span></div>
                <div class="content">${role === 'ai' ? parseContent(text) : text}</div>
            `;
            flow.appendChild(div);
            flow.scrollTop = flow.scrollHeight;
            return div;
        }

        function saveToHistory(text, role) {
            chatHistory.push({ text, role });
            localStorage.setItem('himanshu_history', JSON.stringify(chatHistory.slice(-20))); // Save last 20
        }

        window.clearMemory = () => {
            localStorage.removeItem('himanshu_history');
            location.reload();
        };

        function parseContent(t) {
            return t.replace(/```(\w+)?\n([\s\S]*?)```/g, (m, lang, code) => `<pre class="language-${lang || 'javascript'}"><code>${code.trim()}</code></pre>`)
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>');
        }

        // Auto-expand textarea
        document.getElementById('main-in').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Enter to send
        document.getElementById('main-in').addEventListener('keydown', (e) => { if(e.key==='Enter' && !e.shiftKey) { e.preventDefault(); send(); }});
    </script>
</body>
</html>
